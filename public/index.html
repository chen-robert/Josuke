<head>
  <title>Block Maker</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
  <a class="doc-title" href="/upload.html">Upload Blocks First</a>
  <input id="searcher" onkeypress="search(this)" placeholder="Enter tagline">
  <p id="loading">Loading... Please wait!</p>
  <style>
    #searcher{
      width: 100%;
      padding: 5px;
    }
  
    .doc-title{
      margin: 25px;
      text-align: center;
      display: block;
    }
  
    .subclass{
      font-size: 12px;
      margin: 0;
    }
    
    .subtext-container{
      max-height: 25vh;
      overflow-y: auto;
      
      overflow-wrap: break-word;
    }
    .subtext-wrapper{
      margin: 20px;
      padding: 20px;
      border: 1px solid #ccc;
    }

    
    .section-title{
      font-size: 25px;
      text-align: center;
    }
    
    .tag{
      line-height: 25px;
      padding: 0 20px;
      display: inline-block;
      box-shadow: 5px 5px 5px rgba(68, 68, 68, 0.6);
      background-color: #eee;
      margin: 20px;
      padding: 20px;
    }
    
  </style>
  <script>
    $.get("/data", data => {
      const el = document.createElement("div");
      el.innerHTML = data;

      window.el = el;

      const children = Array.from(el.children);
      const tags = [];

      let curr = {innerText: "", children: []};
      for(let i = 0; i < children.length; i++){
        const a = children[i];
        if(a.tagName !== "P"){
          tags.push(curr);
          curr = {innerText: a.innerText, children: []};
        }else{
          curr.children.push(a);
        }
      }
      tags.push(curr);
      
      
      const subText = a => {
        let text = a.innerText;
        text = text.replace(/((www\.|https?:\/\/)[^\s]+)/g, "<a href='$1'>$1</a>");
        
        return `<p class="subtext">${text}</p>`;
      }
      const buildTag = a => {
      return `
      <strong class="tag">${a.innerText.split("T.").join("<br>T.")}</strong>
      ${ a.children.length === 0? "<br>": 
      `
      <section class="subtext-wrapper">
        <div class="subtext-container">
          ${a.children.map(subText).join("")}
        </div>
      </section>
      `
      }
      `;
      }
      const build = name => {
        document.body.insertAdjacentHTML(
          "beforeend",
`
<h3 class="section-title">${name}</h3>
${tags
  .filter(a => a.innerText.toLowerCase().includes(name.toLowerCase()))
  .map(buildTag).join("")}
`
        );
      };
      window.build = build;
      $("#loading").hide();
    });
    
    const search = elem => {
      if(event.keyCode === 13){
        if(elem.value.trim() === "")return;
        build(elem.value);
        elem.value = ""
      }
    };


  </script>
</body>
